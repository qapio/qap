module com.qapio
import "Qapi.pkl"

typealias Stage = Qapi.Stage
typealias SourceStage = Qapi.SourceStage

function Tick(interval: Int): Stage =
  From(new SourceStage {
    Type = "Source.Tick"
    Props = new Dynamic {
      Interval = interval
    }
  })

function CombineLatest(sources: Listing<Stage>): Stage =
  From(new SourceStage {
    Type = "Source.CombineLatest"
    Props = new Dynamic {
      Sources = sources
    }
  })

function FromExpression(expression: String): Stage =
  From(new SourceStage {
    Type = expression.split("(").first
    Expression = expression
  })

function From(stage: Stage): Stage =
  if (stage is SourceStage)
    stage
  else
    new SourceStage {
      Kind = "Source"
      Type = stage.Type
      Props = stage.Props
    }
